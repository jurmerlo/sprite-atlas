import{I as M,J as Y,A as a,r as f,P as q}from"./vendor-DGN7KDrT.js";import{p as C,b as N}from"./vendor_pngjs-BZQ-QmCi.js";import{L as J,a as V,I as K,D as Q,s as Z,B as S,C as ee,S as y,T as j,F as te,b as se,c as ie,d as H,e as re,f as A,g as T,h as ae,A as ne,i as I,j as le,k as oe,l as L}from"./vendor_mui-Bw82IIXm.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();class B{name;x;y;width;height;constructor(e,t,s,i,r=""){this.x=e,this.y=t,this.width=s,this.height=i,this.name=r}clone(){return new B(this.x,this.y,this.width,this.height,this.name)}area(){return this.width*this.height}}class he{smallestBounds;smallestLayout=[];rectangles;bounds;placedRects=[];gridRows=[];gridColumns=[];grid=[];placed=0;biggestWidth=0;maxWidth;maxHeight;packMethod;constructor(e,t,s,i){this.rectangles=e,this.packMethod=t,this.maxWidth=s,this.maxHeight=i,this.sortRects(),this.bounds=this.setStartBounds(),this.resetPlacements()}pack(){if(this.packMethod==="basic")return this.packRectangles()?!0:(M.stdout.write(`Error: Unable to fit the images inside the bounds.
`),!1);let e=!0,t=!1;for(;!t;)this.packRectangles()?(this.bounds.width-=1,this.bounds.width<this.biggestWidth?t=!0:this.resetPlacements()):(this.smallestBounds||(M.stdout.write(`Error: Unable to fit the images inside the bounds.
`),e=!1),t=!0);return e}setStartBounds(){let e=0,t=0;for(const s of this.rectangles)(t===0||s.height>t)&&(t=s.height),e+=s.width,(this.biggestWidth===0||s.width>this.biggestWidth)&&(this.biggestWidth=s.width);return e>this.maxWidth&&(e=this.maxWidth),new B(0,0,e,t)}packRectangles(){for(;this.placed<this.rectangles.length;){const t=this.rectangles[this.placed];if(this.placeRect(t))this.placedRects.push(t),this.placed++;else{if(this.bounds.height+=t.height,this.bounds.height>this.maxHeight)return!1;this.resetPlacements()}}let e=0;for(let t=0;t<this.gridColumns.length;t++)for(let s=0;s<this.gridRows.length;s++)if(this.grid[s][t]){e+=this.gridColumns[t];break}if(this.bounds.width=e,!this.smallestBounds||this.bounds.area()<this.smallestBounds.area()){this.smallestBounds=this.bounds.clone(),this.smallestLayout=[];for(const t of this.placedRects)this.smallestLayout.push(t.clone())}return!0}resetPlacements(){this.placedRects=[],this.placed=0,this.grid=[[!1]],this.gridColumns=[this.bounds.width],this.gridRows=[this.bounds.height]}placeRect(e){if(this.packMethod==="basic"){for(let t=0;t<this.gridRows.length;t++)for(let s=0;s<this.gridColumns.length;s++)if(!this.grid[t][s]&&this.findPlace(s,t,e))return!0}else for(let t=0;t<this.gridColumns.length;t++)for(let s=0;s<this.gridRows.length;s++)if(!this.grid[s][t]&&this.findPlace(t,s,e))return!0;return!1}findPlace(e,t,s){let i=e,r=t,c=this.gridColumns[e],d=this.gridRows[t];for(;r<this.gridRows.length;){if(this.grid[r][i])return!1;if(d>=s.height)break;r++,r<this.gridRows.length&&(d+=this.gridRows[r])}if(r>=this.gridRows.length)return!1;for(;i<this.gridColumns.length;){for(let l=t;l<r+1;l++)if(this.grid[l][i])return!1;if(c>=s.width)break;i++,i<this.gridColumns.length&&(c+=this.gridColumns[i])}return i>=this.gridColumns.length?!1:(this.insertRect({totalWidth:c,totalHeight:d,startColumn:e,startRow:t,endColumn:i,endRow:r,rectangle:s}),!0)}insertRect({totalWidth:e,totalHeight:t,startColumn:s,startRow:i,endColumn:r,endRow:c,rectangle:d}){const l=e-d.width,p=t-d.height;p>0&&(this.gridRows[c]=this.gridRows[c]-p,this.gridRows.splice(c+1,0,p),this.insertRow(c+1)),l>0&&(this.gridColumns[r]=this.gridColumns[r]-l,this.gridColumns.splice(r+1,0,l),this.insertColumn(r+1));for(let o=i;o<c+1;o++)for(let u=s;u<r+1;u++)this.grid[o][u]=!0;let k=0;for(let o=0;o<s;o++)k+=this.gridColumns[o];let b=0;for(let o=0;o<i;o++)b+=this.gridRows[o];d.x=k,d.y=b}insertRow(e){const t=[...this.grid[e-1]];this.grid.splice(e,0,t)}insertColumn(e){for(const t of this.grid)t.splice(e,0,t[e-1])}sortRects(){this.packMethod==="basic"?this.sortByName():this.sortByHeight()}sortByHeight(){this.rectangles.sort((e,t)=>e.height>t.height?-1:e.height<t.height?1:0)}sortByName(){this.rectangles.sort((e,t)=>e.name>t.name?1:e.name<t.name?-1:0)}}class ce{red;green;blue;alpha;constructor(e,t,s,i){this.red=Math.floor(e),this.green=Math.floor(t),this.blue=Math.floor(s),this.alpha=Math.floor(i)}equals(e){return this.red===e.red&&this.green===e.green&&this.blue===e.blue&&this.alpha===e.alpha}}class v{trimmed;extrude;sourceX;sourceY;sourceWidth;sourceHeight;get width(){return this._pngData.width}get height(){return this._pngData.height}get pngData(){return this._pngData}_pngData;static fromBuffer(e,t,s){const i=C.PNG.sync.read(Y.from(e));return new v({width:i.width,height:i.height,pngData:i,trim:t,extrude:s})}constructor({width:e,height:t,pngData:s,trim:i=!1,extrude:r=0}){if(this.sourceWidth=e,this.sourceHeight=t,this.trimmed=i,this.extrude=r,s){if(this._pngData=new C.PNG({width:e,height:t}),C.PNG.bitblt(s,this._pngData,0,0,e,t,0,0),i){const[c,d]=this.trimTransparentPixels();this.sourceX=c,this.sourceY=d}else this.sourceX=0,this.sourceY=0;r&&this.extrudeEdges(r)}else this._pngData=new C.PNG({width:e,height:t,fill:!0}),this.sourceX=0,this.sourceY=0}getPixels(){return this._pngData.data}getPixel(e,t){const s=(t*this.width+e)*4;return new ce(this._pngData.data[s],this._pngData.data[s+1],this._pngData.data[s+2],this._pngData.data[s+3])}setPixel(e,t,s){const i=(t*this.width+e)*4;this._pngData.data[i]=s.red,this._pngData.data[i+1]=s.green,this._pngData.data[i+2]=s.blue,this._pngData.data[i+3]=s.alpha}extrudeEdges(e){const t=new v({width:this.width,height:this.height,pngData:this._pngData});this._pngData=new C.PNG({width:this.width+e*2,height:this.height+e*2,fill:!0}),C.PNG.bitblt(t._pngData,this._pngData,0,0,t.width,t.height,e,e);let s;for(let i=e;i<t.height+e;i++){s=this.getPixel(e,i);for(let r=0;r<e;r++)this.setPixel(r,i,s);s=this.getPixel(this.width-e-1,i);for(let r=this.width-e-1;r<this.width;r++)this.setPixel(r,i,s)}for(let i=e;i<t.width+e;i++){s=this.getPixel(i,e);for(let r=0;r<e;r++)this.setPixel(i,r,s);s=this.getPixel(i,this.height-e-1);for(let r=this.height-e-1;r<this.height;r++)this.setPixel(i,r,s)}}isEmpty(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)if(this.getPixel(t,e).alpha!==0)return!1;return!0}trimTransparentPixels(){const e=new v({width:this.width,height:this.height,pngData:this._pngData});let t=0,s=0,i=0,r=0;for(let l=0;l<this.width&&U(e,l);l++)t++;for(let l=this.width-1;l>0&&U(e,l);l--)s++;for(let l=0;l<this.height&&W(e,l);l++)i++;for(let l=this.height-1;l>0&&W(e,l);l--)r++;const c=e.width-t-s,d=e.height-i-r;return this._pngData=new C.PNG({width:c,height:d,fill:!0}),C.PNG.bitblt(e._pngData,this._pngData,t,i,c,d,0,0),[t,i]}}function U(n,e){for(let t=0;t<n.height;t++)if(n.getPixel(e,t).alpha!==0)return!1;return!0}function W(n,e){for(let t=0;t<n.width;t++)if(n.getPixel(t,e).alpha!==0)return!1;return!0}class de{packedImage;packedRects=[];images=new Map;rects=[];options;errorFound=!1;constructor(e){this.options=e;for(const t of e.imageFiles){const s=v.fromBuffer(t.data,e.trimmed,e.extrude);this.images.set(t.name,s),this.rects.push(new B(0,0,s.width,s.height,t.name))}}pack(){if(this.errorFound)return!1;const e=new he(this.rects,this.options.packMethod,this.options.maxWidth,this.options.maxHeight);if(!e.pack()||!e.smallestBounds)return!1;this.packedImage=new v({width:e.smallestBounds.width,height:e.smallestBounds.height});for(const t of e.smallestLayout){const s=this.images.get(t.name);s&&N.PNG.bitblt(s.pngData,this.packedImage.pngData,0,0,s.width,s.height,t.x,t.y)}return this.packedRects=e.smallestLayout,console.log(`Atlas "${this.options.name}" has been packed successfully.
`),!0}}function _(n){if(!n.packedImage)return;const e=N.PNG.sync.write(n.packedImage.pngData,{colorType:6}),t=new Blob([new Uint8Array(e)],{type:"image/png"});return URL.createObjectURL(t)}function z(n){const e=N.PNG.sync.write(n.image.pngData,{colorType:6}),t=new Blob([new Uint8Array(e)],{type:"image/png"});return URL.createObjectURL(t)}function ue(n){URL.revokeObjectURL(n)}function ge(n){const e=[];for(const s of n.packedRects){const i=n.images.get(s.name);i&&e.push({filename:s.name,frame:{x:s.x+Number(i.extrude),y:s.y+Number(i.extrude),width:s.width-Number(i.extrude)*2,height:s.height-Number(i.extrude)*2},trimmed:i.trimmed,sourceSize:{x:i.sourceX,y:i.sourceY,width:i.sourceWidth,height:i.sourceHeight}})}const t=new Blob([JSON.stringify({frames:e},null,2)],{type:"application/json"});return URL.createObjectURL(t)}function fe({files:n,onDelete:e}){return a.jsx(J,{dense:!0,sx:{height:300,overflow:"auto",border:"1px solid #ccc",borderRadius:1},children:n.map((t,s)=>a.jsx(V,{secondaryAction:a.jsx(K,{edge:"end",onClick:()=>e(s),children:a.jsx(Q,{})}),children:t.name},t.name))})}const pe=Z("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function me(n){const e=[];if(!n)return Promise.resolve(e);const t=i=>new Promise((r,c)=>{const d=new FileReader;d.onload=l=>{const p=l.target?.result;p&&p instanceof ArrayBuffer?r({name:i.name.split(".")[0],data:p}):c(new Error("Failed to read file as ArrayBuffer"))},d.onerror=()=>{c(new Error("Error reading file"))},d.readAsArrayBuffer(i)}),s=[];for(let i=0;i<n.length;i++){const r=n.item(i);r&&s.push(t(r))}return Promise.all(s)}function $({allowMultiple:n,label:e,onFilesSelected:t}){const s=i=>{me(i).then(r=>t(r))};return a.jsxs(S,{component:"label",role:"button",variant:"contained",tabIndex:-1,startIcon:a.jsx(ee,{}),children:[e,a.jsx(pe,{type:"file",accept:"image/png",onChange:i=>s(i.target.files),multiple:n})]})}function xe({updateImageSrc:n}){const[e,t]=f.useState([]),[s,i]=f.useState("optimal"),[r,c]=f.useState("sprites"),[d,l]=f.useState(1),[p,k]=f.useState(!0),[b,o]=f.useState(4096),[u,x]=f.useState(4096),[w,P]=f.useState(null),D=h=>{t(h)},E=()=>{if(e.length===0||r.trim()==="")return;const h=new de({name:r,imageFiles:e,trimmed:p,extrude:d,packMethod:s,maxWidth:b,maxHeight:u});h.pack(),P(h);const m=_(h);m&&n(m)},g=()=>{if(!w)return;const h=_(w);if(h){const m=document.createElement("a");m.href=h,m.download=`${r}.png`,document.body.appendChild(m),m.click(),document.body.removeChild(m)}setTimeout(()=>{const m=ge(w);if(m){const R=document.createElement("a");R.href=m,R.download=`${r}.json`,document.body.appendChild(R),R.click(),document.body.removeChild(R)}},500)};return a.jsxs(y,{spacing:2,children:[a.jsxs(y,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[a.jsx($,{allowMultiple:!0,onFilesSelected:D,label:"Upload files"}),a.jsx(S,{variant:"outlined",color:"primary",onClick:()=>t([]),disabled:e.length===0,children:"Clear"})]}),a.jsx(fe,{files:e,onDelete:h=>{t(m=>m.filter((R,X)=>X!==h)),n("")}}),a.jsx(j,{label:"Name",variant:"outlined",fullWidth:!0,size:"small",value:r,onChange:h=>c(h.target.value),required:!0}),a.jsxs(y,{direction:"row",spacing:2,children:[a.jsx(j,{type:"number",label:"Extrude",variant:"outlined",size:"small",value:d,onChange:h=>l(Number(h.target.value))}),a.jsx(te,{children:a.jsx(se,{control:a.jsx(ie,{checked:p,onChange:h=>k(h.target.checked)}),label:"Trimmed"})})]}),a.jsxs(y,{direction:"row",spacing:2,children:[a.jsx(j,{type:"number",label:"Max Width",variant:"outlined",size:"small",value:b,onChange:h=>o(Number(h.target.value))}),a.jsx(j,{type:"number",label:"Max Height",variant:"outlined",size:"small",value:u,onChange:h=>x(Number(h.target.value))})]}),a.jsxs(y,{direction:"row",spacing:2,alignItems:"center",children:[a.jsx(H,{variant:"subtitle1",children:"Pack Method"}),a.jsxs(re,{value:s,exclusive:!0,onChange:(h,m)=>i(m),"aria-label":"pack method",children:[a.jsx(A,{color:"primary",value:"basic",size:"small",children:"Basic"}),a.jsx(A,{color:"primary",value:"optimal",size:"small",children:"Optimal"})]})]}),a.jsxs(y,{direction:"row",justifyContent:"space-around",alignItems:"center",children:[a.jsx(S,{variant:"contained",color:"primary",onClick:E,size:"small",disabled:e.length===0||r.trim()==="",children:"Generate Atlas"}),a.jsx(S,{variant:"contained",color:"primary",onClick:g,size:"small",disabled:!w,children:"Download"})]})]})}class be{image;constructor({imageFile:e,tileWidth:t,tileHeight:s,extrude:i}){const r=v.fromBuffer(e.data,!1,0),c=Math.floor(r.width/t),d=Math.floor(r.height/s),l=[];for(let o=0;o<d;o++){const u=[];for(let x=0;x<c;x++){const w=x*t,P=o*s,D=new v({width:t,height:s});N.PNG.bitblt(r.pngData,D.pngData,w,P,t,s),D.extrudeEdges(i??0),u.push(D)}u.length>0&&l.push(u)}let p=0;for(const o of l){for(let u=o.length-1;u>=0&&o[u].isEmpty();u--)o.pop();o.length>p&&(p=o.length)}for(let o=l.length-1;o>=0&&l[o].length===0;o--)l.pop();const k=l.length,b=i*2;this.image=new v({width:p*(t+b),height:k*(s+b)});for(let o=0;o<l.length;o++)for(let u=0;u<l[o].length;u++){const x=l[o][u],w=u*x.width,P=o*x.height;N.PNG.bitblt(x.pngData,this.image.pngData,0,0,x.width,x.height,w,P)}}}function we({updateImageSrc:n}){const[e,t]=f.useState(null),[s,i]=f.useState("tiles"),[r,c]=f.useState(32),[d,l]=f.useState(32),[p,k]=f.useState(1),[b,o]=f.useState(null),[u,x]=f.useState(""),w=g=>{if(g.length!==0){const h=g[0];t(h),x(h.name)}},P=()=>{t(null),x("")},D=()=>{if(!e||s.trim()==="")return;const g=new be({name:s,imageFile:e,tileWidth:r,tileHeight:d,extrude:p});o(g);const h=z(g);h&&n(h)},E=()=>{if(!b)return;const g=z(b);if(g){const h=document.createElement("a");h.href=g,h.download=`${s}.png`,document.body.appendChild(h),h.click(),document.body.removeChild(h)}};return a.jsxs(y,{spacing:2,children:[a.jsxs(y,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[a.jsx($,{allowMultiple:!1,label:"Upload Tileset",onFilesSelected:w}),a.jsx(S,{variant:"outlined",color:"primary",onClick:P,disabled:!e,children:"Clear"})]}),a.jsx(j,{label:"Source",variant:"outlined",fullWidth:!0,size:"small",value:u,disabled:!0}),a.jsx(j,{label:"Name",variant:"outlined",fullWidth:!0,size:"small",value:s,onChange:g=>i(g.target.value),required:!0}),a.jsxs(y,{direction:"row",spacing:2,children:[a.jsx(j,{type:"number",label:"Tile Width",variant:"outlined",size:"small",value:r,onChange:g=>c(Number(g.target.value))}),a.jsx(j,{type:"number",label:"Tile Height",variant:"outlined",size:"small",value:d,onChange:g=>l(Number(g.target.value))})]}),a.jsx(j,{type:"number",label:"Extrude",variant:"outlined",size:"small",value:p,onChange:g=>k(Number(g.target.value))}),a.jsxs(y,{direction:"row",justifyContent:"space-around",alignItems:"center",children:[a.jsx(S,{variant:"contained",color:"primary",onClick:D,size:"small",disabled:!e||s.trim()==="",children:"Extrude Tileset"}),a.jsx(S,{variant:"contained",color:"primary",onClick:E,size:"small",disabled:!b,children:"Download"})]})]})}const F=300;function G({children:n,value:e,index:t,...s}){return a.jsx("div",{role:"tabpanel",hidden:e!==t,id:`tabpanel-${t}`,"aria-labelledby":`tab-${t}`,...s,children:e===t&&a.jsx(T,{sx:{paddingTop:2,borderTop:i=>`1px solid ${i.palette.divider}`},children:n})})}function O(n){return{id:`tab-${n}`,"aria-controls":`tabpanel-${n}`}}function ye(){const[n,e]=f.useState(""),[t,s]=f.useState(0),i=(c,d)=>{s(d)},r=c=>{n&&ue(n),e(c)};return a.jsxs(T,{sx:{display:"flex"},children:[a.jsx(ae,{}),a.jsx(ne,{position:"fixed",sx:{zIndex:c=>c.zIndex.drawer+1},children:a.jsx(I,{variant:"dense",sx:{alignContent:"center"},children:a.jsx(H,{variant:"h6",noWrap:!0,component:"div",children:"Sprite Atlas Generator"})})}),a.jsxs(T,{component:"main",sx:{flexGrow:1,p:1,backgroundColor:"#ddd",height:"100vh",overflow:"auto"},children:[a.jsx(I,{}),n&&a.jsx("img",{src:n,alt:"Atlas Preview"})]}),a.jsxs(le,{variant:"permanent",anchor:"right",sx:{width:F,flexShrink:0,"& .MuiDrawer-paper":{width:F,boxSizing:"border-box"}},children:[a.jsx(I,{}),a.jsxs(T,{sx:{overflow:"auto",paddingLeft:2,paddingRight:2,height:"100vh"},children:[a.jsxs(oe,{value:t,onChange:i,"aria-label":"menu tabs",children:[a.jsx(L,{label:"Atlas",...O(0)}),a.jsx(L,{label:"Tileset",...O(1)})]}),a.jsx(G,{value:t,index:0,children:a.jsx(xe,{updateImageSrc:r})}),a.jsx(G,{value:t,index:1,children:a.jsx(we,{updateImageSrc:r})})]})]})]})}const je=document.getElementById("root");q.createRoot(je).render(a.jsx(f.StrictMode,{children:a.jsx(ye,{})}));
